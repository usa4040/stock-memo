# API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä»•æ§˜

## æ¦‚è¦

Stock Memoã®REST APIã¯ã€Next.js App Routerã®API Routesã§å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚

**ãƒ™ãƒ¼ã‚¹URL:** `http://localhost:3000/api`

---

## èªè¨¼

èªè¨¼ãŒå¿…è¦ãªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ã¯ğŸ”ãƒãƒ¼ã‚¯ãŒä»˜ã„ã¦ã„ã¾ã™ã€‚

èªè¨¼ã¯NextAuth.jsã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚ã‚»ãƒƒã‚·ãƒ§ãƒ³Cookieã«ã‚ˆã‚‹èªè¨¼ãŒå¿…è¦ã§ã™ã€‚

---

## ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§

| ã‚«ãƒ†ã‚´ãƒª | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | ãƒ¡ã‚½ãƒƒãƒ‰ | èªè¨¼ | èª¬æ˜ |
|---|---|---|---|---|
| èªè¨¼ | `/api/auth/*` | - | - | NextAuth.jsç®¡ç† |
| éŠ˜æŸ„ | `/api/stocks` | GET | - | éŠ˜æŸ„ä¸€è¦§ãƒ»æ¤œç´¢ |
| éŠ˜æŸ„ | `/api/stocks/[code]` | GET | - | éŠ˜æŸ„è©³ç´° |
| ãƒ¡ãƒ¢ | `/api/memos` | GET | ğŸ” | ãƒ¡ãƒ¢ä¸€è¦§ |
| ãƒ¡ãƒ¢ | `/api/memos` | POST | ğŸ” | ãƒ¡ãƒ¢ä½œæˆ |
| ãƒ¡ãƒ¢ | `/api/memos/[id]` | GET | â–³ | ãƒ¡ãƒ¢è©³ç´° |
| ãƒ¡ãƒ¢ | `/api/memos/[id]` | PATCH | ğŸ” | ãƒ¡ãƒ¢æ›´æ–° |
| ãƒ¡ãƒ¢ | `/api/memos/[id]` | DELETE | ğŸ” | ãƒ¡ãƒ¢å‰Šé™¤ |
| ã‚¦ã‚©ãƒƒãƒãƒªã‚¹ãƒˆ | `/api/watchlist` | GET | ğŸ” | ä¸€è¦§å–å¾— |
| ã‚¦ã‚©ãƒƒãƒãƒªã‚¹ãƒˆ | `/api/watchlist` | POST | ğŸ” | è¿½åŠ  |
| ã‚¦ã‚©ãƒƒãƒãƒªã‚¹ãƒˆ | `/api/watchlist/[code]` | GET | ğŸ” | çŠ¶æ…‹ç¢ºèª |
| ã‚¦ã‚©ãƒƒãƒãƒªã‚¹ãƒˆ | `/api/watchlist/[code]` | DELETE | ğŸ” | å‰Šé™¤ |
| ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | `/api/dashboard` | GET | ğŸ” | çµ±è¨ˆå–å¾— |

â–³: å…¬é–‹ãƒ¡ãƒ¢ã¯èªè¨¼ä¸è¦ã€éå…¬é–‹ãƒ¡ãƒ¢ã¯èªè¨¼å¿…è¦

---

## éŠ˜æŸ„ API

### GET /api/stocks

éŠ˜æŸ„ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™ã€‚æ¤œç´¢ã«ã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚

**Query Parameters:**

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | å¿…é ˆ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|---|---|---|---|---|
| `q` | string | - | - | æ¤œç´¢ã‚¯ã‚¨ãƒªï¼ˆéŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ã¾ãŸã¯éŠ˜æŸ„åï¼‰ |
| `page` | number | - | 1 | ãƒšãƒ¼ã‚¸ç•ªå· |
| `limit` | number | - | 20 | 1ãƒšãƒ¼ã‚¸ã‚ãŸã‚Šã®ä»¶æ•° |

**Response:**

```json
{
  "data": [
    {
      "code": "7203",
      "name": "ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š",
      "marketSegment": "ãƒ—ãƒ©ã‚¤ãƒ ï¼ˆå†…å›½æ ªå¼ï¼‰",
      "industry33Code": "3050",
      "industry33Name": "è¼¸é€ç”¨æ©Ÿå™¨",
      "industry17Code": "12",
      "industry17Name": "è‡ªå‹•è»Šãƒ»è¼¸é€æ©Ÿ",
      "scaleCode": "1",
      "scaleName": "TOPIX Large70"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 3818,
    "totalPages": 191
  }
}
```

---

### GET /api/stocks/[code]

éŠ˜æŸ„è©³ç´°ã‚’å–å¾—ã—ã¾ã™ã€‚

**Response:**

```json
{
  "code": "7203",
  "name": "ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š",
  "marketSegment": "ãƒ—ãƒ©ã‚¤ãƒ ï¼ˆå†…å›½æ ªå¼ï¼‰",
  "industry33Code": "3050",
  "industry33Name": "è¼¸é€ç”¨æ©Ÿå™¨",
  "industry17Code": "12",
  "industry17Name": "è‡ªå‹•è»Šãƒ»è¼¸é€æ©Ÿ",
  "scaleCode": "1",
  "scaleName": "TOPIX Large70"
}
```

**Error Response:**

| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ã‚¨ãƒ©ãƒ¼ |
|---|---|
| 404 | éŠ˜æŸ„ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ |

---

## ãƒ¡ãƒ¢ API ğŸ”

### GET /api/memos

ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¢ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™ã€‚

**Query Parameters:**

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | å¿…é ˆ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|---|---|---|---|---|
| `q` | string | - | - | ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ |
| `tags` | string | - | - | ã‚¿ã‚°ã§ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰ |
| `page` | number | - | 1 | ãƒšãƒ¼ã‚¸ç•ªå· |
| `limit` | number | - | 20 | 1ãƒšãƒ¼ã‚¸ã‚ãŸã‚Šã®ä»¶æ•° |

**Response:**

```json
{
  "data": [
    {
      "id": "uuid",
      "userId": "uuid",
      "stockCode": "7203",
      "title": "æ±ºç®—åˆ†æ",
      "content": "2024å¹´åº¦ã®æ±ºç®—ã¯...",
      "tags": ["æ±ºç®—", "è²·ã„æ¤œè¨"],
      "pinned": true,
      "visibility": "private",
      "createdAt": "2026-01-01T00:00:00.000Z",
      "updatedAt": "2026-01-01T00:00:00.000Z",
      "stock": {
        "code": "7203",
        "name": "ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š"
      }
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 5,
    "totalPages": 1
  }
}
```

---

### POST /api/memos

æ–°ã—ã„ãƒ¡ãƒ¢ã‚’ä½œæˆã—ã¾ã™ã€‚

**Request Body:**

```json
{
  "stockCode": "7203",
  "content": "æ±ºç®—åˆ†æã®ãƒ¡ãƒ¢å†…å®¹...",
  "title": "æ±ºç®—åˆ†æ",
  "tags": ["æ±ºç®—", "è²·ã„æ¤œè¨"],
  "visibility": "private"
}
```

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | å¿…é ˆ | èª¬æ˜ |
|---|---|---|---|
| `stockCode` | string | âœ“ | éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ï¼ˆ4æ¡ï¼‰ |
| `content` | string | âœ“ | ãƒ¡ãƒ¢å†…å®¹ï¼ˆ1ã€œ10,000æ–‡å­—ï¼‰ |
| `title` | string | - | ã‚¿ã‚¤ãƒˆãƒ« |
| `tags` | string[] | - | ã‚¿ã‚°ï¼ˆæœ€å¤§10å€‹ï¼‰ |
| `visibility` | string | - | `"private"` or `"public"`ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: `"private"`ï¼‰ |

**Response:** `201 Created`

```json
{
  "id": "uuid",
  "userId": "uuid",
  "stockCode": "7203",
  "title": "æ±ºç®—åˆ†æ",
  "content": "æ±ºç®—åˆ†æã®ãƒ¡ãƒ¢å†…å®¹...",
  "tags": ["æ±ºç®—", "è²·ã„æ¤œè¨"],
  "pinned": false,
  "visibility": "private",
  "createdAt": "2026-01-01T00:00:00.000Z",
  "updatedAt": "2026-01-01T00:00:00.000Z",
  "stock": {
    "code": "7203",
    "name": "ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š"
  }
}
```

**Error Response:**

| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ã‚¨ãƒ©ãƒ¼ |
|---|---|
| 400 | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ï¼ˆãƒ¡ãƒ¢å†…å®¹ã¯å¿…é ˆã§ã™ã€ã‚¿ã‚°ã¯æœ€å¤§10å€‹ã¾ã§ç­‰ï¼‰ |
| 401 | èªè¨¼ãŒå¿…è¦ã§ã™ |
| 404 | æŒ‡å®šã•ã‚ŒãŸéŠ˜æŸ„ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ |

---

### GET /api/memos/[id]

ãƒ¡ãƒ¢è©³ç´°ã‚’å–å¾—ã—ã¾ã™ã€‚å…¬é–‹ãƒ¡ãƒ¢ã¯èªè¨¼ä¸è¦ã€éå…¬é–‹ãƒ¡ãƒ¢ã¯æ‰€æœ‰è€…ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ã€‚

**Response:**

```json
{
  "id": "uuid",
  "userId": "uuid",
  "stockCode": "7203",
  "title": "æ±ºç®—åˆ†æ",
  "content": "æ±ºç®—åˆ†æã®ãƒ¡ãƒ¢å†…å®¹...",
  "tags": ["æ±ºç®—", "è²·ã„æ¤œè¨"],
  "pinned": true,
  "visibility": "private",
  "createdAt": "2026-01-01T00:00:00.000Z",
  "updatedAt": "2026-01-01T00:00:00.000Z",
  "stock": {
    "code": "7203",
    "name": "ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š",
    "marketSegment": "ãƒ—ãƒ©ã‚¤ãƒ ï¼ˆå†…å›½æ ªå¼ï¼‰",
    "industry33Name": "è¼¸é€ç”¨æ©Ÿå™¨"
  },
  "user": {
    "name": "ãƒ¦ãƒ¼ã‚¶ãƒ¼å",
    "image": "https://..."
  }
}
```

**Error Response:**

| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ã‚¨ãƒ©ãƒ¼ |
|---|---|
| 403 | ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ |
| 404 | ãƒ¡ãƒ¢ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ |

---

### PATCH /api/memos/[id]

ãƒ¡ãƒ¢ã‚’æ›´æ–°ã—ã¾ã™ã€‚æ‰€æœ‰è€…ã®ã¿æ›´æ–°å¯èƒ½ã§ã™ã€‚

**Request Body:**

```json
{
  "title": "æ›´æ–°å¾Œã®ã‚¿ã‚¤ãƒˆãƒ«",
  "content": "æ›´æ–°å¾Œã®å†…å®¹...",
  "tags": ["æ±ºç®—"],
  "pinned": true,
  "visibility": "public"
}
```

ã™ã¹ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã™ã€‚æŒ‡å®šã—ãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿æ›´æ–°ã•ã‚Œã¾ã™ã€‚

**Error Response:**

| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ã‚¨ãƒ©ãƒ¼ |
|---|---|
| 400 | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ |
| 401 | èªè¨¼ãŒå¿…è¦ã§ã™ |
| 403 | ç·¨é›†æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ |
| 404 | ãƒ¡ãƒ¢ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ |

---

### DELETE /api/memos/[id]

ãƒ¡ãƒ¢ã‚’å‰Šé™¤ã—ã¾ã™ã€‚æ‰€æœ‰è€…ã®ã¿å‰Šé™¤å¯èƒ½ã§ã™ã€‚

**Response:**

```json
{
  "message": "ãƒ¡ãƒ¢ã‚’å‰Šé™¤ã—ã¾ã—ãŸ"
}
```

**Error Response:**

| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ã‚¨ãƒ©ãƒ¼ |
|---|---|
| 401 | èªè¨¼ãŒå¿…è¦ã§ã™ |
| 403 | å‰Šé™¤æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ |
| 404 | ãƒ¡ãƒ¢ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ |

---

## ã‚¦ã‚©ãƒƒãƒãƒªã‚¹ãƒˆ API ğŸ”

### GET /api/watchlist

ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¦ã‚©ãƒƒãƒãƒªã‚¹ãƒˆã‚’å–å¾—ã—ã¾ã™ã€‚

**Response:**

```json
{
  "data": [
    {
      "id": "uuid",
      "userId": "uuid",
      "stockCode": "7203",
      "stockName": "ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š",
      "note": "é•·æœŸæŠ•è³‡å€™è£œ",
      "createdAt": "2026-01-01T00:00:00.000Z"
    }
  ],
  "total": 1
}
```

---

### POST /api/watchlist

éŠ˜æŸ„ã‚’ã‚¦ã‚©ãƒƒãƒãƒªã‚¹ãƒˆã«è¿½åŠ ã—ã¾ã™ã€‚

**Request Body:**

```json
{
  "stockCode": "7203",
  "note": "é•·æœŸæŠ•è³‡å€™è£œ"
}
```

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | å¿…é ˆ | èª¬æ˜ |
|---|---|---|---|
| `stockCode` | string | âœ“ | éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ |
| `note` | string | - | ãƒ¡ãƒ¢ |

**Response:** `201 Created`

**Error Response:**

| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ã‚¨ãƒ©ãƒ¼ |
|---|---|
| 400 | æ—¢ã«ã‚¦ã‚©ãƒƒãƒãƒªã‚¹ãƒˆã«è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ / éŠ˜æŸ„ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ |
| 401 | èªè¨¼ãŒå¿…è¦ã§ã™ |

---

### GET /api/watchlist/[code]

æŒ‡å®šã—ãŸéŠ˜æŸ„ãŒã‚¦ã‚©ãƒƒãƒãƒªã‚¹ãƒˆã«å«ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚

**Response:**

```json
{
  "isWatching": true
}
```

---

### DELETE /api/watchlist/[code]

éŠ˜æŸ„ã‚’ã‚¦ã‚©ãƒƒãƒãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤ã—ã¾ã™ã€‚

**Response:**

```json
{
  "message": "ã‚¦ã‚©ãƒƒãƒãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤ã—ã¾ã—ãŸ"
}
```

---

## ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ API ğŸ”

### GET /api/dashboard

ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™ã€‚

**Response:**

```json
{
  "statistics": {
    "totalMemos": 10,
    "totalStocks": 5,
    "totalTags": 8,
    "pinnedMemos": 2
  },
  "pinnedMemos": [
    {
      "id": "uuid",
      "title": "æ±ºç®—åˆ†æ",
      "stockCode": "7203",
      "stockName": "ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š",
      "contentPreview": "2024å¹´åº¦ã®æ±ºç®—ã¯...",
      "updatedAt": "2026-01-01T00:00:00.000Z"
    }
  ],
  "recentMemos": [
    {
      "id": "uuid",
      "title": "èª¿æŸ»ãƒ¡ãƒ¢",
      "stockCode": "9984",
      "stockName": "ã‚½ãƒ•ãƒˆãƒãƒ³ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—",
      "contentPreview": "äº‹æ¥­ã®å¤šè§’åŒ–...",
      "updatedAt": "2026-01-01T00:00:00.000Z"
    }
  ],
  "topTags": [
    { "tag": "æ±ºç®—", "count": 5 },
    { "tag": "è²·ã„æ¤œè¨", "count": 3 }
  ]
}
```

---

## ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼

ã™ã¹ã¦ã®ã‚¨ãƒ©ãƒ¼ã¯ä»¥ä¸‹ã®å½¢å¼ã§è¿”ã•ã‚Œã¾ã™ã€‚

```json
{
  "error": "ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"
}
```

---

*å‚ç…§: [ãƒ¬ã‚¤ãƒ¤ãƒ¼è²¬å‹™](../architecture/layers.md)*
